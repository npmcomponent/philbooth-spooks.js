(function(){"use strict";function n(n){return m({name:n.name,log:n.log,result:i({archetype:r(n.archetype),log:n.log,chains:n.chains,results:n.results,mode:n.mode})})}function r(n){if(t(n.instance))return n.instance;if(o(n.ctor))return e(n.args)?u(n.ctor,n.args):new n.ctor;throw Error("Invalid archetype")}function t(n){return"object"==typeof n&&null!==n}function o(n){return"function"==typeof n}function e(n){return"[object Array]"===Object.prototype.toString.call(n)}function u(n,r){function t(){return n.apply(this,r)}return t.prototype=n.prototype,new t}function i(n){var r=n.archetype,t=n.spook||{};if(f(r)&&l(r))throw Error("Invalid archetype");if(f(n.log))throw Error("Invalid log");return c(r,t,{log:n.log,chains:n.chains||{},results:n.results||{},mode:n.mode||0}),t}function c(n,r,t){var o;for(o in n)h(n,o,t.mode)&&(r[o]=s(n,o,t));return r}function s(n,r,t){var u=n[r];return o(u)?c(u,m({name:r,log:t.log,chain:t.chains[r],result:t.results[r]}),t):f(u)?u:e(u)?a(u,t):c(u,{},t)}function a(n,r){var t,o=[];for(t=0;n.length>t;t+=1)o.push(s(n,t,r));return o}function f(n){return t(n)===!1}function l(n){return o(n)===!1}function h(n,r,o){return n.hasOwnProperty(r)===!1&&p(o)===!1?!1:t(n[r])?g(o):l(n[r])?y(o):!0}function p(n){return d(j.heavy,n)}function d(n,r){return(n&r)===n}function g(n){return d(j.deep,n)}function y(n){return d(j.wide,n)}function m(n){var r=n.name,t=n.chain,o=n.log,e=n.result;if("string"!=typeof r)throw Error("Invalid function name");return v(o,r,{counts:0,args:[],these:[]}),function(){return I(r,o,arguments,this),t===!0?this:e}}function v(n,r,t){var o;for(o in t)t.hasOwnProperty(o)&&w(n,o,r,t[o])}function w(n,r,t,o){E(n,r,{}),E(n[r],t,o)}function E(n,r,t){n[r]===void 0&&(n[r]=t)}function I(n,r,t,o){r.counts[n]+=1,r.args[n].push(t),r.these[n].push(o)}function b(n){var r,t,o=0,e=n.split(",");for(r=0;e.length>r;r+=1){if(t=j[e[r].trim()],t===void 0)throw Error("Invalid mode");o|=t}return o}var j={wide:1,deep:2,heavy:4},O={ctor:n,obj:i,fn:m,mode:b};"undefined"==typeof module||null===module?window.spooks=O:module.exports=O})();