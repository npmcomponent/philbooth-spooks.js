(function(){"use strict";function n(n){return a({name:n.name,log:n.log,result:u({archetype:r(n.archetype),log:n.log,chains:n.chains,results:n.results})})}function r(n){if(t(n.instance))return n.instance;if(o(n.ctor))return e(n.args)?n.ctor.apply({},n.args):n.ctor.call({});throw Error("Invalid archetype")}function t(n){return"object"==typeof n&&null!==n}function o(n){return"function"==typeof n}function e(n){return"[object Array]"===Object.prototype.toString.call(n)}function u(n){var r,t=n.archetype,e=n.spook||{},u=n.chains||{},s=n.results||{};if(i(t)&&c(t))throw Error("Invalid archetype");if(i(n.log))throw Error("Invalid log");for(r in t)t.hasOwnProperty(r)&&o(t[r])&&(e[r]=a({name:r,log:n.log,chain:u[r],result:s[r]}));return e}function i(n){return"object"!=typeof n||null===n}function c(n){return o(n)===!1}function a(n){var r=n.name,t=n.chain,o=n.log,e=n.result;if("string"!=typeof r)throw Error("Invalid function name");return s(o,r,{counts:0,args:[],these:[]}),function(){return h(r,o,arguments,this),t===!0?this:e}}function s(n,r,t){var o;for(o in t)t.hasOwnProperty(o)&&l(n,o,r,t[o])}function l(n,r,t,o){f(n,r,{}),f(n[r],t,o)}function f(n,r,t){n[r]===void 0&&(n[r]=t)}function h(n,r,t,o){r.counts[n]+=1,r.args[n].push(t),r.these[n].push(o)}var p={ctor:n,obj:u,fn:a};"undefined"==typeof module||null===module?window.spooks=p:module.exports=p})();