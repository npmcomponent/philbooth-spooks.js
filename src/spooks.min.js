(function(n){"use strict";function r(n){return v({name:n.name,log:n.log,result:c({archetype:t(n.archetype),log:n.log,chains:n.chains,results:n.results,mode:n.mode})})}function t(n){if(e(n.instance))return n.instance;if(o(n.ctor))return u(n.args)?i(n.ctor,n.args):new n.ctor;throw Error("Invalid archetype")}function e(n){return"object"==typeof n&&null!==n}function o(n){return"function"==typeof n}function u(n){return"[object Array]"===Object.prototype.toString.call(n)}function i(n,r){function t(){return n.apply(this,r)}return t.prototype=n.prototype,new t}function c(n){var r=n.archetype,t=n.spook||{};if(l(r)&&h(r))throw Error("Invalid archetype");if(l(n.log))throw Error("Invalid log");return f(r,t,{log:n.log,chains:n.chains||{},results:n.results||{},mode:n.mode||0}),t}function f(n,r,t){var e;for(e in n)p(n,e,t.mode)&&(r[e]=s(n,e,t));return r}function s(n,r,t){var e=n[r];return o(e)?f(e,v({name:r,log:t.log,chain:t.chains[r],result:t.results[r]}),t):l(e)?e:u(e)?a(e,t):f(e,{},t)}function a(n,r){var t,e=[];for(t=0;n.length>t;t+=1)e.push(s(n,t,r));return e}function l(n){return e(n)===!1}function h(n){return o(n)===!1}function p(n,r,t){return n.hasOwnProperty(r)===!1&&d(t)===!1?!1:e(n[r])?y(t):h(n[r])?m(t):!0}function d(n){return g(k.heavy,n)}function g(n,r){return(n&r)===n}function y(n){return g(k.deep,n)}function m(n){return g(k.wide,n)}function v(n){var r=n.name,t=n.chain,e=n.log,o=n.result;if("string"!=typeof r)throw Error("Invalid function name");return w(e,r,{counts:0,args:[],these:[]}),function(){return E(r,e,arguments,this),t===!0?this:o}}function w(n,r,t){var e;for(e in t)t.hasOwnProperty(e)&&b(n,e,r,t[e])}function b(n,r,t,e){j(n,r,{}),j(n[r],t,e)}function j(n,r,t){n[r]===void 0&&(n[r]=t)}function E(n,r,t,e){r.counts[n]+=1,r.args[n].push(t),r.these[n].push(e)}function I(n){var r,t,e=0,o=n.split(",");for(r=0;o.length>r;r+=1){if(t=k[o[r].trim()],t===void 0)throw Error("Invalid mode");e|=t}return e}function O(){"function"==typeof define&&define.amd?define(function(){return P}):"object"==typeof module||null!==module?module.exports=P:n.spooks=P}var k={wide:1,deep:2,heavy:4},P={ctor:r,obj:c,fn:v,mode:I};O()})(this);